# RunSight - 智能眼镜运动数据显示应用

## 项目概述

RunSight 是一款专为 Rokid Glasses 智能眼镜开发的运动数据显示应用，主要用于跑步时实时显示佳明手表的运动数据。应用独立运行在眼镜端，通过蓝牙连接佳明手表，解析 FIT 协议数据并在眼镜屏幕上显示关键运动指标。

## 硬件环境

- **设备**: Rokid Glasses 智能眼镜
- **SoC**: 高通 AR1
- **屏幕**: 480×640 分辨率，双目单绿色显示
- **交互方式**: 
  - 拍照按键：单击拍照，长按录像
  - 触控板：单击确认，左右滑动导航，双击返回

## 功能需求

### 核心功能

1. **蓝牙设备扫描与连接**
   - 扫描附近的佳明手表设备
   - 通过触控板选择目标设备
   - 建立蓝牙 GATT 连接

2. **运动数据接收与解析**
   - 接收佳明手表广播的 FIT 协议数据
   - 解析运动数据包，提取关键指标
   - 实时更新数据状态

3. **运动数据显示**
   - 心率 (BPM)
   - 配速 (分钟/公里)
   - 运动时间 (时:分:秒)
   - 累计距离 (公里)

4. **交互控制**
   - 触控板导航设备选择
   - 连接状态管理
   - 简单的界面切换

### 性能要求

- **显示帧率**: 1Hz (节能考虑)
- **连接稳定性**: 支持断线重连
- **电量优化**: 最小化后台处理

## 技术方案

### 开发环境

- **IDE**: Android Studio
- **语言**: Kotlin
- **构建系统**: Gradle (Kotlin DSL)
- **UI框架**: Jetpack Compose + XR Compose
- **最低SDK**: API 34 (Android 14)
- **目标SDK**: API 36

### 核心技术栈

1. **XR开发框架**
   - CXR-S SDK (Rokid 官方 SDK)
   - androidx.xr.compose (XR Compose 库)
   - androidx.xr.runtime (XR 运行时)
   - androidx.xr.scenecore (场景核心)

2. **蓝牙通信**
   - Android Bluetooth API
   - GATT (Generic Attribute Profile)
   - BLE (Bluetooth Low Energy)

3. **数据解析**
   - Garmin FIT SDK (Java 版本)
   - FIT 协议解析库
   - 自定义数据模型

4. **UI组件**
   - Jetpack Compose
   - Material Design 3 (适配单色显示)
   - 自定义绿色主题

### 项目架构

```
com.mouzhi.runsight/
├── ui/
│   ├── theme/           # 主题和样式
│   ├── screens/         # 界面组件
│   │   ├── ScanScreen   # 设备扫描界面
│   │   ├── DataScreen   # 数据显示界面
│   │   └── ConnectScreen # 连接状态界面
│   └── components/      # 通用UI组件
├── bluetooth/
│   ├── BluetoothManager # 蓝牙管理器
│   ├── GattCallback     # GATT回调处理
│   └── DeviceScanner    # 设备扫描器
├── fit/
│   ├── FitDataParser    # FIT数据解析器
│   ├── FitMessage       # FIT消息模型
│   └── SportDataModel   # 运动数据模型
├── data/
│   ├── repository/      # 数据仓库
│   └── models/          # 数据模型
└── utils/
    ├── Constants        # 常量定义
    └── Extensions       # 扩展函数
```

## 设计规范

### 视觉设计

基于 Rokid Glasses 官方设计规范：

- **画布尺寸**: 480×640 像素
- **最佳显示区域**: 480×400 像素
- **主色调**: 绿色 #40FF5E (100% 透明度)
- **设计原则**: 单色显示，无渐变效果
- **图标**: 使用官方提供的单色图标库

### 界面布局

1. **设备扫描界面**
   ```
   ┌─────────────────────┐
   │    连接佳明手表      │
   │                    │
   │  🔍 正在扫描...     │
   │                    │
   │  📱 Garmin Watch 1  │
   │  📱 Garmin Watch 2  │
   │                    │
   │  ← → 选择 ⚪ 确认   │
   └─────────────────────┘
   ```

2. **运动数据显示界面**
   ```
   ┌─────────────────────┐
   │  ❤️  心率: 145 BPM  │
   │                    │
   │  ⏱️  配速: 5'30"    │
   │                    │
   │  🕐  时间: 25:43    │
   │                    │
   │  📏  距离: 4.8 km   │
   │                    │
   │     [连接状态]      │
   └─────────────────────┘
   ```

### 交互设计

- **触控板单击**: 确认选择/进入
- **触控板左滑**: 上一项/返回
- **触控板右滑**: 下一项/前进
- **触控板双击**: 返回上级/退出
- **拍照按键**: 暂不使用（预留功能）

## 开发计划

### 第一阶段：基础框架 (1-2天)
- [x] 项目结构分析
- [x] 产品规划文档
- [ ] 集成 FIT SDK
- [ ] 基础 UI 框架搭建

### 第二阶段：核心功能 (3-4天)
- [ ] 蓝牙扫描和连接
- [ ] FIT 数据解析
- [ ] 运动数据显示界面
- [ ] 触控板交互

### 第三阶段：优化完善 (1-2天)
- [ ] 性能优化 (1Hz 刷新)
- [ ] 错误处理和重连
- [ ] 用户体验优化

## 技术风险与解决方案

### 风险点

1. **FIT SDK 集成复杂性**
   - 解决方案：使用 Java 版本 SDK，通过 JNI 调用

2. **蓝牙连接稳定性**
   - 解决方案：实现重连机制，添加连接状态监控

3. **XR 环境适配**
   - 解决方案：严格遵循 Rokid 官方开发规范

4. **电量消耗控制**
   - 解决方案：降低刷新频率，优化后台处理

### 依赖管理

- Rokid CXR-S SDK: 1.0-20250519.061355-45
- Garmin FIT SDK: 最新 Java 版本
- Android XR Compose: 1.0.0-alpha05
- Kotlin: 2.0.21
- Android Gradle Plugin: 8.13.0

## 测试策略

1. **单元测试**: FIT 数据解析逻辑
2. **集成测试**: 蓝牙连接和数据传输
3. **设备测试**: 在 Rokid Glasses 上的实际运行
4. **性能测试**: 电量消耗和响应速度

## 部署说明

1. 通过 Android Studio 直接安装到 Rokid Glasses
2. 确保设备已开启开发者模式
3. 配置 ADB 连接进行调试
4. 最终打包为 APK 文件分发

---

**项目状态**: 规划阶段  
**预计完成时间**: 7-10 天  
**负责人**: 开发团队  
**最后更新**: 2025年1月